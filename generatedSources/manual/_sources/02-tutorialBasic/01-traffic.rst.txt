.. _traffic:

Connect Your Traffic Receiver
=============================

Midair collisions are a major reason for loss of lives in general aviation.
Collisions often happen near airfields or in the traffic circuit. In order to
enhance security, **Enroute Flight Navigation** can connect to your aircraft's
traffic receiver, typically a FLARM device. Once connected, the moving map will
show nearby traffic.

.. _EDTFtraffic:
.. figure:: ./autogenerated/02-01-01-traffic.png
   :scale: 30 %
   :align: center
   :alt: Approaching EDTF with Traffic

   Approaching EDTF with Traffic

The figure :ref:`EDTFtraffic` shows what to expect.  The figure shows two
traffic factors.

- There is one aircraft in the downwind section of the traffic circuit.  The
  traffic has approximately the same altitude as the own aircraft and is
  sinking.  The green color indicates "no alarm".
- There is one aircraft nearby whose precise position is unknown to the traffic
  receiver; this is often the case with traffic that has only a Mode-S
  transponder.  The traffic is most likely found within the yellow circle. The
  yellow color indicates that the traffic might be close enough to be dangerous.

The section :ref:`mainPage` covers the traffic display in detail.

.. note:: To show only relevant traffic, **Enroute Flight Navigation** will
    display traffic factors only if the vertical distance is less than 1,500 m
    and the horizontal distance less than 20 nm.

.. warning:: **Enroute Flight Navigation** does not issue traffic warnings.  The 
    app contains no collision avoidance algorithms.  Color coding of traffic 
    according to relevance works best with FLARM devices.
   
    
Compatibility
-------------

**Enroute Flight Navigation** should work with all modern, standard-compliant
traffic receivers.  The author has tested the following receivers.

- `AT-1 AIR Traffic <http://www.air-avionics.com/?page_id=253>`_ by `Air
  Avionics <http://www.air-avionics.com/>`__.

- `PowerFLARM Core <https://flarm.com/flarm-product/powerflarm-core-pure/>`_ by
  `FLARM Technology Ltd <https://flarm.com/>`_, and `AIR Connect
  <https://www.air-avionics.com/?page_id=401>`_ Wi-Fi Adaptor by `Air Avionics
  <http://www.air-avionics.com/>`__.
  
- `PowerFLARM Fusison <https://flarm.com/flarm-product/powerflarm-fusion/>`_ by
  `FLARM Technology Ltd <https://flarm.com/>`_.
  
Users reported success with the following traffic receiver hardware.

- Classic FLARM and the `ICFly Connect <https://in-circuit.de/shop/icfly-connect>`_ 
  Wi-Fi adaptor, set to IP 192.168.1.1 and TCP Port 2000.
- `SkyEcho2 <https://uavionix.com/products/skyecho/>`_ -- but see the Sections
  :ref:`skyEcho` and :ref:`gdl90problems`
- `PilotAware Rosetta <https://www.pilotaware.com/rosetta/>`_
- `pingUSB <https://uavionix.com/products/pingusb>`_ -- but see the Sections 
  :ref:`pingUSB` and :ref:`gdl90problems`
- `Stratux devices <http://stratux.me/>`_
- `TTGO T-Beam devices <https://www.amazon.de/TTGO-T-Beam-915Mhz-Wireless-Bluetooth/dp/B07SFVQ3Z8>`_

.. note:: Most traffic data receivers can only handle one concurrent connection.
    If more devices connect, this might lead to frequent loss of connection or
    loss of data.  To be on the safe side, it might be useful to ask your
    passengers to disable Wi-Fi on their phone before boarding.

.. note:: For best results, use FLARM compatible devices.  If your traffic
    receiver supports FLARM/NMEA as well as GDL90 output, always use FLARM/NMEA.
    The GDL90 protocol has a number of shortcomings that **Enroute Flight
    Navigation** cannot always work around.  See the Section
    :ref:`gdl90problems` for more details.

  
Connect!
--------

It takes three steps to connect **Enroute Flight Navigation** to the traffic
receiver for the first time. Once things are set up properly, your device should
automatically detect the traffic receiver's Wi-Fi network, enter the network and
connect to the traffic data stream whenever you go flying.

Step 0: Before You Connect
^^^^^^^^^^^^^^^^^^^^^^^^^^

Before you try to connect this app to your traffic receiver, make sure that the
following conditions are met.

- Your traffic receiver has an integrated Wi-Fi interface that acts as a
  wireless access point. Bluetooth is currently not supported.
- You know the network name (=SSID) of the Wi-Fi network deployed by your
  traffic receiver. If the network is encrypted, you also need to know the Wi-Fi
  password.
- Some devices require an additional password in order to access traffic data.
  If this is the case, you will need to know this password.


Step 1: Enter the Traffic Receiver's Wi-Fi Network
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- Make sure that the traffic receiver has power and is switched on. In a typical
  aircraft installation, the traffic receiver is connected to the 'Avionics'
  switch and will automatically switch on. You may need to wait a minute before
  the Wi-Fi comes online and is visible to your device.
- Enter the Wi-Fi network deployed by your traffic receiver. This is usually
  done in the "Wi-Fi Settings" of your device. Enter the Wi-Fi password if
  required. Some devices will issue a warning that the Wi-Fi is not connected to
  the internet. In this case, you might need to confirm that you wish to enter
  the Wi-Fi network.

Most operating systems will offer to remember the connection, so that your
device will automatically connect to this Wi-Fi in the future. We recommend
using this option.

Step 2: Connect to the Traffic Data Stream
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Open the main menu and navigate to the "Information" menu.

- If the entry "Traffic Receiver" is highlighted in green, then **Enroute Flight
  Navigation** has already found the traffic receiver in the network and has
  connected to it. Congratulations, you are done!
- If the entry "Traffic Receiver" is not highlighted in green, then select the
  entry. The "Traffic Receiver Status" page will open. The page explains the
  connection status in detail, and explains how to establish a connection
  manually.

Troubleshooting
^^^^^^^^^^^^^^^

**The app cannot connect to the traffic data stream.**

- Check that your device is connected to the Wi-Fi network deployed by your
  traffic receiver.
  
**The connection breaks down after a few seconds.**

Most traffic receivers cannot serve more than one client and abort connections
at random if more than one device tries to access.

- Make sure that there no second device connected to the traffic receiver's
  Wi-Fi network. The other device might well be in your friend's pocket!
- Make sure that there is no other app trying to connect to the traffic
  receiver's data stream.
- Many traffic receivers offer "configuration panels" that can be accessed via a
  web browser. Close all web browsers.


Flarmnet Data
-------------

**Enroute Flight Navigation** is able to use the database from `Flarmnet.org
<https://www.flarmnet.org/flarmnet/>`_ to identify aircraft and to show the
aircraft registration in the moving map display.  The process does not require
user interaction: once the app connects to a FLARM device and receives traffic
information, the Flarmnet database will automatically be downloaded and updated
with every map update.  If desired, the database can also be downloaded manually
on the page "Maps and Data" (open the main menu and go to "Library/Maps and
Data").
