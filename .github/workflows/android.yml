name: Compile on Android

on:
  create:
    branches: [ main, working ]
  push:
    branches: [ main, working ]
  pull_request:
    branches: [ main, working ]

jobs:
  build:

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        submodules: true
    - name: Install Qt for Desktop
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.4.*'
    - name: Set QT_HOST_PATH
      run: |
        echo QT_HOST_PATH=$Qt6_DIR >> $GITHUB_ENV
    - name: Install Qt for Android
      uses: jurplel/install-qt-action@v3
      with:
        target: 'android'
        version: '6.4.*'
        arch: 'android_arm64_v8a'
    - name: Install Additional Software
      run: |
        sudo apt install doxygen graphviz librsvg2-bin
        echo "y" | ${ANDROID_SDK_ROOT}/cmdline-tools/latest/bin/sdkmanager "platforms;android-31" "platform-tools" "build-tools;31.0.0"
        echo "y" | ${ANDROID_SDK_ROOT}/cmdline-tools/latest/bin/sdkmanager --uninstall "platforms;android-33-ext5" "platforms;android-33-ext4"
        echo "y" | ${ANDROID_SDK_ROOT}/cmdline-tools/latest/bin/sdkmanager "ndk;23.1.7779620"
        echo ANDROID_NDK_ROOT=$ANDROID_SDK_ROOT/ndk/23.1.7779620 >> $GITHUB_ENV
    - name: Configure
      run: |
        mkdir -p build
        $Qt6_DIR/bin/qt-cmake -DCMAKE_BUILD_TYPE:STRING=Debug -S . -B build
    - name: Compile
      run: |
        cmake --build build
